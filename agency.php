<?php

// Get DOI agency for a set of DOI prefixes

require_once (dirname(__FILE__) . '/lib.php');

$dois=array(

"10.16380/j.kcxb.2016.04.001",
"10.18195/issn.0313-122x.79.2011.109-122",
"10-3724/SP.J.1141.2008.06667",
"10.1002/(issn)1522-239x",
"10.1006/anbo.1993.1001",
"10.1007/11557.1861-8952",
"10.1016/0304-3770(75)90036-4",
"10.1017/jpa.2014.10",
"10.1038/118623a0",
"10.1046/j.0019-1019.2001.00001.x",
"10.1051/acarologia/20101950",
"10.1071/bi9480231",
"10.1080/00173137409429902",
"10.1086/297055",
"10.1093/aesa/1.1.1",
"10.1098/rstb.1906.0009",
"10.1111/(issn)1438-8677a",
"10.11110/kjpt.2012.42.1.001",
"10.1127/0006-8152/2002/0124-0013",
"10.1139/9780660167091",
"10.1155/1874/14506",
"10.11606/issn.2176-7793.v15i1-2p1-176",
"10.11609/jott.2016.8.3.8541-8640",
"10.11646/1132",
"10.1179/204234811X13194453002869",
"10.11813/j.issn.0254-5853.2013.3.0139",
"10.11853/j.issn.1003.4692.2013.04.001",
"10.1186/1810-522X-52-1",
"10.11865/j.zs.20140406",
"10.11913/PSJ-2095-0837.2015.50641",
"10.11926/j.issn.1005-3395.04.011",
"10.11931/guihaia.gxzw201303018",
"10.1206/3794.1",
"10.1242/jcs.00270",
"10.12705/622.1",
"10.12905/0380.sydowia66(1)2014-0001",
"10.13102/neod.11.1",
"10.13130/2039-4942/5208",
"10.13346/j.mycosystema.120079",
"10.1360/aps020122",
"10.1371/journal.pone.0010502",
"10.13918/j.issn.2095-8137.2014.313",
"10.14203/reinwardtia.v10i1.248",
"10.14258/turczaninowia",
"10.14522/darwiniana.2016.41.682",
"10.1515/agp-2015-0001",
"10.1525/auk.2008.060144",
"10.15281/jplantres1887.1.10_189",
"10.15298/arctoa.01.01",
"10.15381/rpb.v10i1.2465",
"10.15446/caldasia",
"10.15517//lank.v16i2.25997",
"10.15553/c2010v651a1",
"10.1556/034.57.2015.3-4.1",
"10.15625/0866-7160/v38n4.8837",
"10.1590/0031-1049.2014.54.01",
"10.15914/j.cnki.wykx.1992.00.001",
"10.1600/03634412x635539",
"10.1603/0013-8746(2000)093[0001:ipcrbm]2.0.co;2",
"10.1635/0097-3157(2001)151[0001:msohmg]2.0.co;2",
"10.1636/01-85",
"10.16380/j.kcxb.2016.04.007",
"10.1640/0002-8444(2001)091[0001:tgoagi]2.0.co;2",
"10.1642/0004-8038(2000)117[0001:efapus]2.0.co;2",
"10.1649/0010-065x(2000)054[0001:tncgfc]2.0.co;2",
"10.1663/0006-8101(2002)068[0001:f]2.0.co;2",
"10.1664/0028-7199(2000)108[0001:cbahro]2.0.co;2",
"10.1666/0022-3360(2000)074<0001:rossau>2.0.co;2",
"10.1676/0043-5643(2006)118[268:ol]2.0.co;2",
"10.17109/azh.61.1.1.2015",
"10.17110/StudBot.2016.47.1.163",
"10.17112/foliaenthung.2014.75.133",
"10.17129/botsci.103",
"10.17151/bccm.2015.19.1.1",
"10.17223/20764103.113.7",
"10.17581/bp.2016.05204",
"10.18195/10.18195/issn.0312-3162.23(1).2006.001-006",
"10.18474/0749-8004-45.1.1",
"10.18476/sbna.v10.a1",
"10.18636/bioneotropical.v6i2.342",
"10.18785/grr.0101.01",
"10.1890/13-2000.1",
"10.18984/lepid.51.1_49",
"10.20324/nelumbo/v1/1959/76637",
"10.20531/TFB.2016.44.1.01",
"10.20546/ijcrbp.2017.405.012",
"10.21248/contrib.entomol.15.1-2.101-110",
"10.21411/CBM.A.1068BDCE",
"10.21782/RMAR1995-2449-2016-3(22-32)",
"10.2179/11-022",
"10.21829/abm1.1988.556",
"10.22497/arnaldoa.232",
"10.2307/1215944",
"10.2317/0022-8567(2004)077[0293:arnihh]2.0.co;2",
"10.2331/suisan.24.445",
"10.24199/j.mmv.1906.1.01",
"10.24272/j.issn.2095-8137.2017.003",
"10.2478/agp-2013-0001",
"10.25223/brad.n1.1983.a1",
"10.2982/0012-8317(2005)94[165:ANTAFT]2.0.CO;2",
"10.2984/049.063.0201",
"10.2985/0007-9367-83.4.169",
"10.2987/08-09.1",
"10.2988/00006-324x-128.2.137",
"10.2989/00306520109485276",
"10.3100/0.25.016.0201",
"10.3114/sim.2006.56.01",
"10.3119/00-10.1",
"10.3120/0024-9637(2005)52[107:mamect]2.0.co;2",
"10.3157/0002-8320(2006)132[103:rocaso]2.0.co;2",
"10.3158/2158-5520-17.10.1",
"10.3159/TORREY-D-11-00061.1",
"10.3161/000345408783897789",
"10.3321/j.issn:0254-5853.1999.01.001",
"10.3329/bjpt.v19i1.10939",
"10.3356/0892-1016(2006)40[111:fhotfi]2.0.co;2",
"10.3372/wi.26.2601",
"10.3398/064.076.0305",
"10.3406/jatba.1921.1292",
"10.3409/173491504783995762",
"10.3417/0026-6493(2006)93[103:piglrg]2.0.co;2",
"10.3724/SP.J.1141,2011.05566",
"10.3732/ajb.0700005",
"10.3767/000651903x489384",
"10.3850/s2382581215000010",
"10.3852/06-111r",
"10.3860/acta.v55i0.1485",
"10.3897/BDJ.2.e4281",
"10.3906/bot-1207-55",
"10.3969/j.issn.0001-6616.2009.04.003",
"10.3989/ajbm",
"10.4003/006.026.0201",
"10.4038/tapro.v6i2.7229",
"10.4067/s0717-66432000000100001",
"10.4102/abc.v10i1.1503",
"10.4236/ajps.2012.31002",
"10.4314/ejb.v13i1.6",
"10.5091/plecevo.2010.365",
"10.5169/seals-400145",
"10.5209/rev_LAZA.2011.v32.37817",
"10.5248/107.1",
"10.5252/a2009n1a1",
"10.5354/0717-8883.1843.23216",
"10.5377/ceiba.v47i1-2.441",
"10.5380/abpr.v10i0",
"10.5431/aramit0101",
"10.5479/si.0081024x.1",
"10.5575/geosoc.31.371_255",
"10.5586/1160",
"10.5598//imafungus.2011.02.02.01",
"10.5642/aliso",
"10.5710/102.053.0201",
"10.5735/085.045.0101",
"10.5852/ejt.2011.1",
"10.5897/AJB11.302",
"10.5902/2358198013881",
"10.5943/mycosphere/2/2",
"10.5962/bhl.part.10148",
"10.6165/tai.1948.1.1",
"10.6620/ZS.2016.52-20",
"10.7320/Bocc25.005",
"10.7525/j.issn.1673-5102.2006.01.001",
"10.7550/rmb.17897",
"10.7606/j.issn.1000-4025.2014.01.0001",
"10.7677/ynzwyj201311142",
"10.7717/peerj.2800",
"10.7751/telopea",
"10.7872/095.034.0101");

$dois=array("10.21248/contrib.entomol.15.1-2.101-110");

$count = 1;

foreach ($dois as $doi)
{
	//echo "-- $doi\n";
	
	$prefix = substr($doi, 0, strpos($doi, "/"));
	
	$url = 'http://api.crossref.org/works/' . $doi . '/agency';
	
	$json = get($url);
	
	if ($json != '')
	{
		$obj = json_decode($json);
		
		if (isset($obj->message->agency))
		{
			echo "-- $prefix " . $obj->message->agency->id . "\n";
			
			echo 'UPDATE publications SET doi_agency="' . $obj->message->agency->id . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
		}
	}
	
	if (($count++ % 10) == 0)
	{
		$rand = rand(1000000, 3000000);
		echo '-- sleeping for ' . round(($rand / 1000000),2) . ' seconds' . "\n";
		usleep($rand);
	}
	
}	

?>